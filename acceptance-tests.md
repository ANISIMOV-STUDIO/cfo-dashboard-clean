# Acceptance-тесты CFO Dashboard

## Функциональные тесты

### 1. Загрузка и инициализация
**Тест-кейс**: Корректная загрузка дашборда
- **Действие**: Открыть HTML файл в 1С
- **Ожидаемый результат**: 
  - Дашборд загружается без ошибок за ≤3 сек
  - Все блоки отображаются корректно
  - API `window.external1C` доступен
- **Критерии прохождения**: ✅ Зеленый статус во всех элементах

### 2. API для 1С
**Тест-кейс**: Обновление данных через API
- **Действие**: Вызов `window.external1C.updateDashboard(sampleData)`
- **Ожидаемый результат**:
  - Данные обновляются за ≤50ms
  - Все KPI отображают актуальные значения
  - Графики перерисовываются корректно
- **Критерии прохождения**: ✅ JSON валидируется, UI обновляется

### 3. KPI блок
**Тест-кейс**: Отображение ключевых показателей
- **Действие**: Проверить верхнюю полосу KPI
- **Ожидаемый результат**:
  - Выручка: 125.6 млн ₽, +8.5% MoM
  - EBITDA: 28.9 млн ₽, +23.2% YoY
  - OCF: 31.2 млн ₽
  - Cash: 45.6 млн ₽, 4.2 мес (warning)
  - Маржа: 23.1% (переключатель работает)
- **Критерии прохождения**: ✅ Все значения корректны, цвета соответствуют IBCS

## Визуальные тесты (IBCS)

### 4. Цветовая схема
**Тест-кейс**: Соответствие стандартам IBCS
- **Действие**: Проверить все графики
- **Ожидаемый результат**:
  - Факт: черный (#1a1a1a)
  - План: белый с черной границей
  - Прошлый год: серый (#8e8e93)
  - Прогноз: синий пунктир (#007aff)
  - Положительные отклонения: зеленый (#34c759)
  - Отрицательные отклонения: красный (#ff3b30)
- **Критерии прохождения**: ✅ Цвета точно соответствуют спецификации

### 5. Сортировка данных
**Тест-кейс**: Правильная сортировка в графиках
- **Действие**: Проверить горизонтальный бар "Выручка по направлениям"
- **Ожидаемый результат**: Направления отсортированы по убыванию выручки
- **Критерии прохождения**: ✅ Самый большой столбец сверху

## Sprint 5 - Navigation & Forecast Tests

### 6. Cash Forecast Scenarios
**Тест-кейс**: Переключение сценариев кэш-прогноза
- **Действие**: Перейти на страницу "Ликвидность", переключить сценарии
- **Ожидаемый результат**:
  - База/Опт./Песс. кнопки работают за ≤25ms
  - График обновляется с разными данными
  - Баланс ниже нуля вызывает алерт `cash_shortage`
- **Критерии прохождения**: ✅ Переключение быстрое, алерт работает

### 7. Deep Linking Navigation
**Тест-кейс**: Прямые ссылки с параметрами
- **Действие**: Открыть URL `#/cash?scenario=base`
- **Ожидаемый результат**:
  - Открывается страница "Ликвидность"
  - Активен сценарий "База"
  - URL соответствует состоянию
- **Критерии прохождения**: ✅ Навигация работает с параметрами

### 8. Role-based Presets
**Тест-кейс**: Переключение ролей
- **Действие**: Вызвать `external1C.setRole('CEO')`, затем 'CFO', затем 'Sales'
- **Ожидаемый результат**:
  - CEO: Обзор, минимум контролов
  - CFO: Ликвидность, развернутые алерты
  - Sales: Прибыльность, режим 100%
- **Критерии прохождения**: ✅ Роли мгновенно меняют интерфейс

### 9. EBITDA Drivers Waterfall
**Тест-кейс**: EBITDA-мост по драйверам
- **Действие**: Открыть страницу "Прибыльность"
- **Ожидаемый результат**:
  - Водопадная диаграмма План → Драйверы → Факт
  - Сортировка драйверов по вкладу
  - Переключение млн₽/% маржи
  - Тултипы показывают детали
- **Критерии прохождения**: ✅ Сумма драйверов = ΔEBITDA

### 10. Print Layout
**Тест-кейс**: Печать страниц
- **Действие**: Нажать "Печать страницы" и "Печать все"
- **Ожидаемый результат**:
  - Чистые листы A4 landscape без обрезаний
  - Логотип, заголовки, временные метки
  - SVG-иконки вместо эмодзи
  - Отключены интерактивные элементы
- **Критерии прохождения**: ✅ Профессиональный вид печати

### 11. PNG Export Enhancement
**Тест-кейс**: Экспорт с текстовыми блоками
- **Действие**: Вызвать `exportCurrentPagePNG()`
- **Ожидаемый результат**:
  - Включены не только canvas, но и заголовки/таблицы
  - HiDPI качество (2x devicePixelRatio)
  - Читаемые шрифты без "тумана"
- **Критерии прохождения**: ✅ Полный снимок страницы высокого качества
- **Ожидаемый результат**: Розница > Опт > Онлайн (по убыванию)
- **Критерии прохождения**: ✅ Данные отсортированы по значению

### 6. Единицы измерения
**Тест-кейс**: Корректные единицы в заголовках
- **Действие**: Проверить заголовки графиков
- **Ожидаемый результат**:
  - "Динамика выручки, млн ₽"
  - "Маржинальность, %"
  - "DSO: 47 дн."
  - "Cash Runway: 4.2 мес."
- **Критерии прохождения**: ✅ Единицы указаны везде

## Тесты производительности

### 7. Скорость загрузки
**Тест-кейс**: Время первоначальной загрузки
- **Условия**: V8WebKit 8.3.27, типичные данные
- **Метрика**: Time to Interactive ≤3000ms
- **Измерение**: `performance.now()` до/после инициализации
- **Критерии прохождения**: ✅ ≤3000ms

### 8. Перерисовка при обновлении данных
**Тест-кейс**: Скорость обновления UI
- **Условия**: Вызов `updateDashboard()` с новыми данными
- **Метрика**: Update time ≤50ms
- **Измерение**: Время от вызова API до завершения render
- **Критерии прохождения**: ✅ ≤50ms

### 9. Отзывчивость интерфейса
**Тест-кейс**: Переключение элементов управления
- **Действие**: Клики по кнопкам переключения серий
- **Метрика**: Response time ≤16ms (60 FPS)
- **Измерение**: `requestAnimationFrame` callback timing
- **Критерии прохождения**: ✅ ≤16ms

### 10. Потребление памяти
**Тест-кейс**: Утечки памяти при частых обновлениях
- **Действие**: 100 циклов обновления данных каждые 1000ms
- **Метрика**: Memory growth ≤10MB
- **Измерение**: `performance.memory.usedJSHeapSize`
- **Критерии прохождения**: ✅ Стабильное потребление памяти

## Тесты совместимости

### 11. WebKit 8.3.27
**Тест-кейс**: Работа в старой версии WebKit
- **Условия**: V8WebKit версии 8.3.27
- **Проверки**:
  - Chart.js 3.9 загружается и работает
  - Canvas API функционирует
  - ES5 совместимость (без стрелочных функций)
  - CSS Grid поддерживается
- **Критерии прохождения**: ✅ Полная функциональность

### 12. Разрешения экрана
**Тест-кейс**: Адаптивность на разных разрешениях
- **Условия**: 1366x768, 1920x1080, 2560x1440
- **Ожидаемый результат**:
  - При ≤1400px: сетка становится одноколоночной
  - KPI карточки не ломаются
  - Горизонтальная прокрутка работает
- **Критерии прохождения**: ✅ UI корректен на всех разрешениях

## Тесты алертов

### 13. Генерация алертов
**Тест-кейс**: Правильное срабатывание алертов
- **Условия**: 
  - Cash Runway = 4.2 мес (< 6)
  - Концентрация Сбербанк = 65.2% (> 60%)
  - Просрочка 90+ = 3.1 млн (> 2 млн)
- **Ожидаемый результат**: 3 алерта с корректной серьезностью
- **Критерии прохождения**: ✅ Алерты отображаются с правильными цветами

### 14. Приоритизация алертов
**Тест-кейс**: Сортировка по важности
- **Действие**: Несколько алертов разной серьезности
- **Ожидаемый результат**: critical > high > medium > low
- **Критерии прохождения**: ✅ Порядок соответствует приоритету

## Тесты данных

### 15. Валидация данных - битые структуры (Sprint 3)
**Тест-кейс**: Рантайм валидация против data-schema.json
- **Действие**: Передача некорректной структуры данных
- **Тестовые данные**:
```javascript
// Отсутствует обязательное поле 'meta'
const invalidData1 = { kpi: {}, timeSeries: {}, structures: {} };

// Неверный тип данных
const invalidData2 = { 
    meta: { currency: "INVALID" },
    kpi: { revenue: "not a number" }
};

// Несогласованные массивы
const invalidData3 = {
    meta: {},
    timeSeries: { 
        revenue: { 
            dates: ["2024-01", "2024-02"], 
            fact: [100, 200, 300] // Длина не совпадает с dates
        }
    }
};
```
- **Ожидаемый результат**: 
  - Красный баннер валидации появляется вверху экрана
  - В консоли logged детали ошибок
  - Дашборд продолжает работать с graceful degradation
- **Критерии прохождения**: ✅ Валидатор детектирует все ошибки, UI не ломается

### 16. Валидация данных - отсутствующие поля (Sprint 3)
**Тест-кейс**: Graceful degradation при неполных данных
- **Действие**: Удаление `timeSeries.revenue.forecast` из sample-data.json
- **Тестовый сценарий**:
```bsl
// В 1С создаем данные без прогноза
ДанныеБезПрогноза = СкопироватьДанныеДашборда();
ДанныеБезПрогноза.timeSeries.revenue.Удалить("forecast");

КомандаJS = "window.external1C.updateDashboard(" + СериализоватьВJSON(ДанныеБезПрогноза) + ")";
Результат = HTMLПоле.ВыполнитьJavaScript(КомандаJS);
```
- **Ожидаемый результат**:
  - Серия "Прогноз" не отображается на графике
  - Чекбокс "Прогноз" в фильтрах неактивен
  - Остальные серии работают нормально
  - Предупреждение в console.log
- **Критерии прохождения**: ✅ Дашборд адаптируется к неполным данным

### 17. Валидация данных - типы и диапазоны (Sprint 3)
**Тест-кейс**: Проверка числовых ограничений и формул
- **Действие**: Передача данных с нарушениями бизнес-логики
- **Тестовые случаи**:
```javascript
// CCC формула не сходится
const testData1 = {
    coefficients: {
        dso: 45,
        dii: 30, 
        dpo: 25,
        ccc: 40  // Должно быть 50 (45+30-25)
    }
};

// Валовая маржа >100%
const testData2 = {
    kpi: {
        margins: { gross: 150 } // Физически невозможно
    }
};

// DSO больше года
const testData3 = {
    coefficients: { dso: 400 }
};

// Отрицательная сумма дебитора
const testData4 = {
    debtors: [{ 
        name: "Test Debtor", 
        amount: -1000,
        bucket: "invalid-bucket"
    }]
};
```
- **Ожидаемый результат**:
  - Валидатор выдает предупреждения для каждого нарушения
  - CCC: "расчет не сходится: 40 vs расчетный 50.0"
  - Валовая маржа: "вне ожидаемого диапазона: 150%"
  - DSO: "вне разумного диапазона: 400 дней"
  - Дебитор: "Неверная сумма дебитора Test Debtor: -1000"
  - Bucket: "Неизвестный bucket для Test Debtor: invalid-bucket"
- **Критерии прохождения**: ✅ Все нарушения детектируются, отображается баннер

### 18. Новые API методы - фильтры (Sprint 3)
**Тест-кейс**: Управление фильтрами из 1С
- **Действие**: Тестирование setFilters/getFilters API
- **BSL тест**:
```bsl
&НаКлиенте
Процедура ТестФильтров()
    // Установка фильтров
    НовыеФильтры = Новый Структура;
    НовыеФильтры.Вставить("periodPreset", "quarter");
    НовыеФильтры.Вставить("showForecast", Ложь);
    НовыеФильтры.Вставить("percentageMode", Истина);
    
    КомандаУстановки = "
    |const result = window.external1C.setFilters(" + СериализоватьВJSON(НовыеФильтры) + ");
    |JSON.stringify(result);";
    
    РезультатУстановки = HTMLПоле.ВыполнитьJavaScript(КомандаУстановки);
    
    // Получение фильтров
    КомандаПолучения = "window.external1C.getFilters()";
    ТекущиеФильтры = HTMLПоле.ВыполнитьJavaScript(КомандаПолучения);
    
    // Проверка
    ФильтрыОбъект = РазобратьJSONСтроку(ТекущиеФильтры);
    
    УтверждениеИстина(ФильтрыОбъект.periodPreset = "quarter");
    УтверждениеИстина(ФильтрыОбъект.showForecast = Ложь);
    УтверждениеИстина(ФильтрыОбъект.percentageMode = Истина);
КонецПроцедуры
```
- **Ожидаемый результат**:
  - setFilters возвращает `{success: true, message: "Filters applied successfully"}`
  - getFilters возвращает актуальное состояние фильтров
  - Фильтры сохраняются в localStorage.dash.filters
  - UI обновляется в соответствии с новыми фильтрами ≤100ms
- **Критерии прохождения**: ✅ API работает стабильно, состояние синхронизировано

### 19. Новые API методы - экспорт (Sprint 3) 
**Тест-кейс**: Экспорт PNG и KPI снапшот
- **Действие**: Тестирование exportPNG/getKPISnapshot API
- **BSL тест**:
```bsl
&НаКлиенте
Процедура ТестЭкспорта()
    // Тест PNG экспорта
    КомандаPNG = "
    |window.external1C.exportPNG().then(result => {
    |    window._testPNG = result;
    |    'png_ready';
    |})";
    
    РезультатPNG = HTMLПоле.ВыполнитьJavaScript(КомандаPNG);
    УтверждениеРавенство(РезультатPNG, "png_ready");
    
    // Получаем результат PNG
    КомандаПолученияPNG = "JSON.stringify(window._testPNG)";
    ДанныеPNG = HTMLПоле.ВыполнитьJavaScript(КомандаПолученияPNG);
    РезультатPNGОбъект = РазобратьJSONСтроку(ДанныеPNG);
    
    УтверждениеИстина(РезультатPNGОбъект.success);
    УтверждениеИстина(НачинаетсяСтрокой(РезультатPNGОбъект.dataURL, "data:image/png;base64,"));
    УтверждениеБольше(РезультатPNGОбъект.width, 1000);
    
    // Тест KPI снапшота
    КомандаKPI = "window.external1C.getKPISnapshot()";
    РезультатKPI = HTMLПоле.ВыполнитьJavaScript(КомандаKPI);
    СнапшотОбъект = РазобратьJSONСтроку(РезультатKPI);
    
    УтверждениеИстина(СнапшотОбъект.Свойство("timestamp"));
    УтверждениеИстина(СнапшотОбъект.Свойство("kpi"));
    УтверждениеИстина(СнапшотОбъект.Свойство("coefficients"));
    УтверждениеИстина(СнапшотОбъект.Свойство("formulas"));
    УтверждениеИстина(СнапшотОбъект.formulas.Свойство("DSO"));
КонецПроцедуры
```
- **Ожидаемый результат**:
  - PNG экспорт возвращает валидный base64 data URL
  - Размер PNG соответствует размеру дашборда  
  - KPI снапшот содержит все ключевые метрики
  - Формулы DSO/DPO/CCC включены для справки
  - Активные алерты включены в снапшот
- **Критерии прохождения**: ✅ Экспорт работает, данные корректны

### 20. Оффлайн бандл и производительность (Sprint 3)
**Тест-кейс**: Работа без CDN, размер бандла, скорость загрузки
- **Условия**: Файл dashboard.bundle.js вместо CDN Chart.js
- **Проверки**:
```javascript
// В консоли браузера
console.log('Chart.js loaded:', typeof Chart !== 'undefined');
console.log('Bundle plugins:', typeof Chart.CrispPlugin !== 'undefined');
console.log('Load time:', performance.getEntriesByType('navigation')[0].loadEventEnd);

// Размер бандла
fetch('./dashboard.bundle.js')
  .then(response => response.blob())
  .then(blob => {
    console.log('Bundle size:', (blob.size / 1024).toFixed(1) + ' KB');
    console.log('Bundle gzipped:', blob.size < 300*1024 ? 'PASS' : 'FAIL');
  });
```
- **Ожидаемый результат**:
  - dashboard.bundle.js ≤ 300 КБ (gzip)
  - Загрузка ≤ 200 мс на V8WebKit 8.3.27
  - Chart конструктор доступен
  - Плагины (CrispPlugin, WaterfallPlugin, VariancePlugin) доступны  
  - Sparklines отрисовываются корректно
  - Полифилы для Promise/Object.assign работают
- **Критерии прохождения**: ✅ Оффлайн режим, производительность соблюдена

### 21. Алерты - расширенная функциональность (Sprint 3)
**Тест-кейс**: Dismiss, Snooze, Jump to source, фильтры severity
- **Действие**: Тестирование всех функций управления алертами
- **Сценарий тестирования**:
```javascript
// Генерируем тестовые алерты
const testAlerts = [
    { id: "test1", severity: "critical", type: "cash_shortage", message: "Critical test" },
    { id: "test2", severity: "high", type: "overdue", message: "High test" },
    { id: "test3", severity: "medium", type: "dso_deterioration", message: "Medium test" }
];

// Симулируем алерты
dashboardData.alerts = testAlerts;
updateAlertsDisplay();

// Тест колокольчика
console.log('Bell visible:', document.getElementById('alerts-bell').style.display !== 'none');
console.log('Counter shows:', document.getElementById('alerts-counter').textContent);

// Тест фильтрации
document.querySelector('[data-severity="critical"]').click();
const visibleAlerts = document.querySelectorAll('.alert-item:not([style*="display: none"])');
console.log('Critical filter:', visibleAlerts.length === 1);

// Тест dismiss  
dismissAlert('test1');
const dismissedStored = JSON.parse(localStorage.getItem('dash.alerts')).dismissed;
console.log('Dismiss works:', dismissedStored.includes('test1'));

// Тест snooze
snoozeAlert('test2', '24h');
const snoozedStored = JSON.parse(localStorage.getItem('dash.alerts')).snoozed;
console.log('Snooze works:', snoozedStored.hasOwnProperty('test2'));
```
- **Ожидаемый результат**:
  - Колокольчик показывает правильный счетчик (3 → 2 → 1)
  - Фильтры severity работают (All/Critical/High/Medium)
  - Dismiss удаляет алерт навсегда
  - Snooze скрывает на указанное время
  - Jump to source скроллит к нужному блоку с подсветкой 1.5с
  - Состояние алертов сохраняется в localStorage
- **Критерии прохождения**: ✅ Все функции алертов работают стабильно

## Интеграционные тесты с 1С

### 18. Вызов из 1С
**Тест-кейс**: HTMLПоле.ВыполнитьJavaScript()
- **Действие**: Вызов JavaScript кода из 1С
- **BSL код**:
```bsl
Результат = HTMLПоле.ВыполнитьJavaScript("window.external1C.getDashboardState()");
```
- **Ожидаемый результат**: Возвращается JSON с состоянием
- **Критерии прохождения**: ✅ 1С получает корректный ответ

### 19. Передача больших данных
**Тест-кейс**: JSON размером >100KB
- **Условия**: Данные за 3 года с детализацией по дням
- **Метрика**: Передача и обработка ≤200ms
- **Критерии прохождения**: ✅ Без таймаутов и ошибок

### 20. Кодировка UTF-8
**Тест-кейс**: Корректное отображение русских символов
- **Условия**: Названия контрагентов, банков на русском
- **Ожидаемый результат**: Все символы отображаются корректно
- **Критерии прохождения**: ✅ Нет кракозябр

## Тесты пользовательского интерфейса

### 21. Интерактивность графиков
**Тест-кейс**: Tooltip и hover эффекты
- **Действие**: Наведение мыши на элементы графиков
- **Ожидаемый результат**: 
  - Tooltip с детальной информацией
  - Hover эффекты работают плавно
- **Критерии прохождения**: ✅ UI отзывчивый, информативный

### 22. Переключатели
**Тест-кейс**: Кнопки управления графиками
- **Действие**: Клики по кнопкам Факт/План/ПГ/Прогноз
- **Ожидаемый результат**: 
  - Серии скрываются/показываются
  - Активные кнопки выделены
- **Критерии прохождения**: ✅ Все переключатели работают

### 23. Спарклайны
**Тест-кейс**: Мини-графики в таблицах
- **Действие**: Проверить спарклайны в коэффициентах и счетах
- **Ожидаемый результат**: 
  - Графики отрисовываются корректно
  - Показывают тренд данных
- **Критерии прохождения**: ✅ Визуально корректные спарклайны

## Нагрузочные тесты

### 24. Множественные обновления
**Тест-кейс**: Частые вызовы updateDashboard()
- **Условия**: 10 обновлений в секунду в течение 1 минуты
- **Метрика**: UI остается отзывчивым, нет блокировок
- **Критерии прохождения**: ✅ Стабильная работа без деградации

### 25. Большие таблицы
**Тест-кейс**: 1000+ дебиторов в таблице
- **Условия**: Массив из 1000 записей
- **Ожидаемый результат**: 
  - Виртуализация работает (если реализована)
  - Или разумная пагинация
- **Критерии прохождения**: ✅ UI не зависает

## Критерии готовности к продакшену

### Обязательные требования (100% прохождение):
- [x] Функциональные тесты (1-6)
- [x] Визуальные тесты IBCS (7-9)
- [x] Производительность базовая (10-12)
- [x] Совместимость WebKit (13-14)
- [x] Интеграция с 1С (15-17)

### Желательные требования (80%+ прохождение):
- [x] Продвинутые тесты UI (18-20)
- [x] Нагрузочные тесты (21-22)
- [x] Граничные случаи (23-25)

## Автоматизация тестирования

### Скрипт для автоматической проверки:
```javascript
// Можно запустить в консоли браузера
function runAcceptanceTests() {
    const results = [];
    
    // Тест 1: API доступность
    results.push({
        test: "API availability",
        passed: typeof window.external1C !== 'undefined'
    });
    
    // Тест 2: Данные загружены
    results.push({
        test: "Data loaded",
        passed: dashboardData !== null
    });
    
    // Тест 3: Графики созданы
    results.push({
        test: "Charts created",
        passed: Object.keys(charts).length >= 5
    });
    
    // Тест 4: IBCS цвета
    results.push({
        test: "IBCS colors",
        passed: IBCS_COLORS.fact === '#1a1a1a'
    });
    
    console.table(results);
    return results.every(r => r.passed);
}
```

### Интеграция в CI/CD:
```bash
# Puppeteer тест для автоматизации
npm test -- --timeout=30000 --headless
```

## Sprint 6.1 - Stabilization Tests (Hotfixes)

### 26. Initialization Without Errors
**Тест-кейс**: Чистая загрузка без JavaScript ошибок
- **Действие**: Открыть дашборд и проверить консоль браузера
- **Ожидаемый результат**: 
  - Отсутствие `SyntaxError` и `ReferenceError`
  - Дашборд полностью загружается за ≤3 сек
  - Вкладки кликабельны сразу после загрузки
- **Критерии прохождения**: ✅ Ноль ошибок в консоли

### 27. Deep Link Navigation
**Тест-кейс**: Прямые ссылки на конкретные страницы
- **Действие**: Открыть URL `http://localhost:8000#/cash`
- **Ожидаемый результат**:
  - Открывается именно страница "Ликвидность"
  - Вкладка "Ликвидность" помечена активной
  - URL остается корректным при переключении
- **Критерии прохождения**: ✅ Deep-linking работает стабильно

### 28. Абсолют/100% Toggle
**Тест-кейс**: Переключение режимов отображения 
- **Действие**: Найти кнопки "Абсолют" / "100%" и протестировать переключение
- **Ожидаемый результат**:
  - Кнопки переключаются мгновенно (≤25ms)
  - График "Выручка по направлениям" обновляется без пересоздания
  - В режиме "100%" показаны доли, в режиме "Абсолют" — суммы
  - Состояние сохраняется в localStorage.dash.mode.share
- **Критерии прохождения**: ✅ Переключение работает визуально

### 29. Density Mode Toggle
**Тест-кейс**: Переключение плотности интерфейса
- **Действие**: Найти селектор плотности, переключить между "compact" и "comfort"
- **Ожидаемый результат**:
  - Визуальная разница в размерах карточек и отступах
  - Плотность применяется ко всем элементам дашборда  
  - Состояние сохраняется в localStorage.dash.density
  - Без вертикального скролла на 1920×1080
- **Критерии прохождения**: ✅ Плотность меняется, адаптивность сохраняется

### 30. Print Page Functionality
**Тест-кейс**: Печать текущей страницы без ошибок
- **Действие**: Нажать кнопку "Печать страницы"
- **Ожидаемый результат**:
  - Открывается диалог печати браузера
  - В preview видна только текущая страница 
  - Содержимое оптимизировано для A4 landscape
  - Логотип CFO, дата/время, номера страниц присутствуют
- **Критерии прохождения**: ✅ Функция печати работает без JavaScript ошибок

### 31. Export Page/All Pages
**Тест-кейс**: Экспорт в PNG без ошибок
- **Действие**: Протестировать кнопки "📸 Страница", "📁 Все", "📦 Batch"
- **Ожидаемый результат**:
  - Кнопки вызывают соответствующие глобальные функции
  - В браузере показывается mock результат
  - В консоли нет ошибок `xxx is not defined`
  - Batch export создает и скачивает JSON manifest
- **Критерии прохождения**: ✅ Все экспорт функции доступны глобально

### 32. Header Height Calculation
**Тест-кейс**: Динамическая высота хедера исправляет наложение контента
- **Действие**: Изменить размер окна браузера, проверить отступы
- **Ожидаемый результат**:
  - CSS переменная `--header-h` устанавливается автоматически
  - Контент dashboard начинается ровно под хедером (без наложения)
  - При resize высота пересчитывается через 100ms
- **Критерии прохождения**: ✅ Контент не уходит под фиксированную шапку

### 33. Mini-Linter Self Check
**Тест-кейс**: Проверка кода на распространенные ошибки
- **Действие**: В консоли браузера выполнить `__dbg.selfCheck()`
- **Ожидаемый результат**:
  - Возвращает объект с пустым массивом errors: `{errors: [], warnings: [], passed: true}`
  - Проверяет паттерны `.newData`, `Math.max.`, дубли ID, дубли функций
  - Подтверждает наличие всех глобальных объектов
- **Критерии прохождения**: ✅ Ноль ошибок на чистой сборке

### 34. Alerts Panel State Management  
**Тест-кейс**: Панель алертов не "залипает"
- **Действие**: Открыть/закрыть панель алертов, сменить роль, перезагрузить страницу
- **Ожидаемый результат**:
  - Используется только класс `.open` (не `.active`)
  - Состояние корректно восстанавливается после перезагрузки
  - Смена роли не приводит к "залипанию" панели
  - ESC и клик вне панели корректно её закрывают
- **Критерии прохождения**: ✅ Управление состоянием стабильное

### 35. Performance Metrics Validation
**Тест-кейс**: Соответствие целевым показателям производительности
- **Действие**: Измерить ключевые операции через performance API
- **Ожидаемый результат**:
  - Переключение страниц ≤25 мс
  - updateDashboard() ≤50 мс  
  - Применение фильтров ≤100 мс
  - applyShareMode() ≤25 мс
- **Критерии прохождения**: ✅ Все цели производительности достигнуты

### Критерии готовности Sprint 6.1:
- [x] Стабилизация (тесты 26-35): 100% прохождение  
- [x] Отсутствие регрессий в ранее рабочих тестах 1-25
- [x] Mini-linter показывает 0 ошибок
- [x] Все hotfix требования выполнены