<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤ CFO Dashboard</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .test-container { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-container { 
            width: 100%; 
            height: 300px; 
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        h2 { color: #333; }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤ CFO Dashboard</h1>
    
    <div class="test-container">
        <h2>–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π</h2>
        <div id="modules-status"></div>
    </div>
    
    <div class="test-container">
        <h2>–¢–µ—Å—Ç 1: –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (–¥–æ—Ö–æ–¥—ã)</h2>
        <div class="chart-container">
            <canvas id="test-line-chart"></canvas>
        </div>
    </div>
    
    <div class="test-container">
        <h2>–¢–µ—Å—Ç 2: –ú—É–ª—å—Ç–∏-–ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (–º–∞—Ä–∂–∏)</h2>
        <div class="chart-container">
            <canvas id="test-margins-chart"></canvas>
        </div>
    </div>
    
    <div class="test-container">
        <h2>–¢–µ—Å—Ç 3: –°—Ç–æ–ª–±—á–∞—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫</h2>
        <div class="chart-container">
            <canvas id="test-bar-chart"></canvas>
        </div>
    </div>
    
    <div class="test-container">
        <h2>–¢–µ—Å—Ç 4: Waterfall –≥—Ä–∞—Ñ–∏–∫</h2>
        <div class="chart-container">
            <canvas id="test-waterfall-chart"></canvas>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="src/core/charts-styles.css">
    <link rel="stylesheet" href="src/core/charts-fonts-fix.css">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ -->
    <script src="lib/Chart-2.9.4.min.js"></script>
    <script src="src/core/charts-redesigned.js"></script>
    <script src="src/core/charts-loader.js"></script>
    <script src="src/core/renderers.js"></script>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç—É—Å–∞
        function showStatus(message, type) {
            var statusDiv = document.getElementById('modules-status');
            statusDiv.innerHTML += '<div class="status ' + type + '">' + message + '</div>';
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π
        function checkModules() {
            showStatus('Chart.js: ' + (window.Chart ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' : '‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω'), 
                      window.Chart ? 'success' : 'error');
            showStatus('ChartsRedesigned: ' + (window.ChartsRedesigned ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' : '‚ö†Ô∏è –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω'), 
                      window.ChartsRedesigned ? 'success' : 'warning');
            showStatus('ChartsLoader: ' + (window.ChartsLoader ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' : '‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω'), 
                      window.ChartsLoader ? 'success' : 'error');
            showStatus('PageRenderers: ' + (window.PageRenderers ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' : '‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω'), 
                      window.PageRenderers ? 'success' : 'error');
        }
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
        function testCharts() {
            if (!window.PageRenderers) {
                showStatus('‚ùå PageRenderers –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, —Ç–µ—Å—Ç—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã', 'error');
                return;
            }
            
            try {
                // –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
                var lineChart = window.PageRenderers.safeCreateChart('line', 'test-line-chart', {
                    labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π'],
                    fact: [100000, 120000, 110000, 135000, 125000],
                    plan: [105000, 115000, 115000, 130000, 130000]
                });
                
                showStatus('–¢–µ—Å—Ç 1 (–ª–∏–Ω–µ–π–Ω—ã–π): ' + (lineChart ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞'), 
                          lineChart ? 'success' : 'error');
                
                // –¢–µ—Å—Ç 2: –ú—É–ª—å—Ç–∏-–ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (–º–∞—Ä–∂–∏)
                var marginsChart = window.PageRenderers.safeCreateChart('line', 'test-margins-chart', {
                    labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π'],
                    datasets: [
                        { label: '–í–∞–ª–æ–≤–∞—è –º–∞—Ä–∂–∞', data: [45.2, 46.1, 44.8, 47.3, 46.5] },
                        { label: 'EBITDA', data: [18.3, 19.1, 17.9, 19.5, 18.8] },
                        { label: '–ß–∏—Å—Ç–∞—è –º–∞—Ä–∂–∞', data: [12.1, 12.8, 11.5, 13.2, 12.6] }
                    ]
                });
                
                showStatus('–¢–µ—Å—Ç 2 (–º—É–ª—å—Ç–∏-–ª–∏–Ω–µ–π–Ω—ã–π): ' + (marginsChart ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞'), 
                          marginsChart ? 'success' : 'error');
                
                // –¢–µ—Å—Ç 3: –°—Ç–æ–ª–±—á–∞—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫
                var barChart = window.PageRenderers.safeCreateChart('bar', 'test-bar-chart', {
                    labels: ['–ú–æ—Å–∫–≤–∞', '–°–ü–±', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫'],
                    values: [45600000, 32400000, 18900000, 21700000],
                    horizontal: false
                });
                
                showStatus('–¢–µ—Å—Ç 3 (—Å—Ç–æ–ª–±—á–∞—Ç—ã–π): ' + (barChart ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞'), 
                          barChart ? 'success' : 'error');
                
                // –¢–µ—Å—Ç 4: Waterfall –≥—Ä–∞—Ñ–∏–∫
                var waterfallChart = window.PageRenderers.safeCreateChart('waterfall', 'test-waterfall-chart', {
                    labels: ['–ù–∞—á–∞–ª–æ', '–î–æ—Ö–æ–¥—ã', '–†–∞—Å—Ö–æ–¥—ã', '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '–ö–æ–Ω–µ—Ü'],
                    values: [1000000, 500000, -200000, -100000, 1200000],
                    startValue: 1000000
                });
                
                showStatus('–¢–µ—Å—Ç 4 (waterfall): ' + (waterfallChart ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞'), 
                          waterfallChart ? 'success' : 'error');
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —à—Ä–∏—Ñ—Ç–æ–≤
                setTimeout(function() {
                    checkFontSizes();
                }, 2000);
                
            } catch (error) {
                showStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: ' + error.message, 'error');
                console.error('Test error:', error);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —à—Ä–∏—Ñ—Ç–æ–≤
        function checkFontSizes() {
            showStatus('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —à—Ä–∏—Ñ—Ç–æ–≤...', 'warning');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Chart.js
                if (window.Chart && window.Chart.defaults && window.Chart.defaults.global) {
                    var fontSize = window.Chart.defaults.global.defaultFontSize;
                    showStatus('–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ Chart.js: ' + fontSize + 'px', 
                              fontSize >= 14 ? 'success' : 'warning');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                var canvases = document.querySelectorAll('canvas');
                showStatus('–ù–∞–π–¥–µ–Ω–æ canvas —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ' + canvases.length, 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                var computedStyle = getComputedStyle(document.body);
                var chartFontSize = computedStyle.getPropertyValue('--chart-font-size');
                if (chartFontSize) {
                    showStatus('CSS –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è --chart-font-size: ' + chartFontSize, 'success');
                }
                
                showStatus('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —á–∏—Ç–∞–µ–º—ã–µ —à—Ä–∏—Ñ—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–º 14px', 'success');
                
            } catch (error) {
                showStatus('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —à—Ä–∏—Ñ—Ç–æ–≤: ' + error.message, 'warning');
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            setTimeout(function() {
                checkModules();
                setTimeout(testCharts, 1000);
            }, 500);
        });
    </script>
</body>
</html>