<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CFO Dashboard</title>
  <style>
    :root {
      --bg: #f3f4f6;
      --panel: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --accent: #0a84ff;
      --shadow: 0 2px 20px rgba(0,0,0,0.06);
      --radius: 16px;
    }
    html,body { height:100%; }
    body { margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background:linear-gradient(180deg,#f7f8fa 0%,#eef1f5 100%); -webkit-font-smoothing:antialiased; }
    .dashboard { min-width:1360px; max-width:1600px; margin:24px auto; padding:0 24px 48px; }
    .dashboard-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
    .title { font-weight:700; font-size:24px; letter-spacing:-0.01em; }
    .status { font-size:12px; color:var(--muted); margin-top:4px; }
    .controls { display:grid; grid-template-columns: repeat(3, 240px) 1fr; gap:12px 16px; align-items:end; margin:12px 0 6px; }
    .control { display:flex; flex-direction:column; gap:6px; }
    .control label { font-size:12px; color:var(--muted); }
    select, .preset-group { height:36px; border-radius:10px; border:1px solid #e5e7eb; background:var(--panel); box-shadow:var(--shadow); padding:0 12px; font-size:14px; color:var(--text); outline:none; }
    .preset-group { display:inline-flex; align-items:center; padding:2px; gap:2px; width:max-content; }
    .preset-btn { border:0; height:30px; padding:0 12px; border-radius:8px; background:transparent; color:var(--text); cursor:pointer; font-size:13px; }
    .preset-btn.active { background:var(--accent); color:white; }
    .page-navigation { display:flex; align-items:center; gap:8px; margin:12px 0 6px; }
    .segmented { display:inline-flex; background:var(--panel); border-radius:12px; padding:3px; box-shadow:var(--shadow); border:1px solid #e5e7eb; }
    .segment-tab { border:0; background:transparent; padding:8px 14px; border-radius:9px; font-size:13px; color:var(--text); cursor:pointer; }
    .segment-tab.active { background:var(--accent); color:#fff; }
    main { margin-top:12px; }
    .page-content { display:none; }
    .page-content.active { display:block; }
    .grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:16px; }
    .card { background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; display:flex; flex-direction:column; min-height:240px; }
    .card .card-header { padding:12px 14px; border-bottom:1px solid #eef2f7; display:flex; align-items:center; justify-content:space-between; }
    .card .card-title { font-size:14px; font-weight:600; }
    .card .card-subtle { font-size:12px; color:var(--muted); }
    .card .chart-body { padding:12px; flex:1 1 auto; display:flex; }
    .chart-body canvas { width:100% !important; height:100% !important; }
    #alerts-container { position:fixed; right:24px; bottom:24px; z-index:100; max-width:360px; }
    .alert { background:var(--panel); border-radius:12px; box-shadow:var(--shadow); margin-bottom:12px; border-left:4px solid #ff9500; overflow:hidden; transition:all 0.3s ease; }
    .alert-header { display:flex; align-items:center; padding:12px; gap:8px; }
    .alert-icon { width:20px; height:20px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-size:12px; }
    .alert-icon-critical { background:#ff3b30; color:white; }
    .alert-icon-high { background:#ff6347; color:white; }
    .alert-icon-medium { background:#ff9500; color:white; }
    .alert-icon-low { background:#34c759; color:white; }
    .alert-title { flex:1; font-weight:600; font-size:13px; }
    .alert-severity { font-size:11px; color:var(--muted); text-transform:uppercase; }
    .alert-dismiss { border:0; background:transparent; font-size:18px; color:var(--muted); cursor:pointer; padding:0; width:20px; height:20px; }
    .alert-message { padding:0 12px 12px; font-size:12px; color:var(--text); }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="dashboard-header">
      <div>
        <div class="title">CFO Dashboard</div>
        <div id="loading-indicator" class="status">Загрузка…</div>
      </div>
      <div id="alerts-container" aria-live="polite"></div>
    </div>
    <div class="controls">
      <div class="control">
        <label>Период</label>
        <div class="preset-group" role="tablist" aria-label="Быстрый период">
          <button class="preset-btn active" data-preset="month">Месяц</button>
          <button class="preset-btn" data-preset="quarter">Квартал</button>
          <button class="preset-btn" data-preset="year">Год</button>
        </div>
      </div>
      <div class="control">
        <label>Компания</label>
        <select id="company-select">
          <option value="all">Все компании</option>
        </select>
      </div>
      <div class="control">
        <label>Режим</label>
        <select id="mode-select">
          <option value="absolute" selected>Абсолютные</option>
          <option value="percentage">Доли (100%)</option>
        </select>
      </div>
      <div></div>
    </div>
    <div class="page-navigation">
      <div class="segmented" role="tablist" aria-label="Разделы">
        <button class="segment-tab active" data-page="overview" aria-selected="true">Обзор</button>
        <button class="segment-tab" data-page="sales">Продажи</button>
        <button class="segment-tab" data-page="profit">Прибыльность</button>
        <button class="segment-tab" data-page="cash">ДДС и ликвидность</button>
        <button class="segment-tab" data-page="ar">Дебиторка</button>
      </div>
    </div>
    <main id="pages">
      <section id="page-overview" class="page-content active">
        <div class="grid">
          <div class="card"><div class="card-header"><div class="card-title">Динамика выручки, млн ₽</div><div class="card-subtle">Факт · План · ПГ · Прогноз</div></div><div class="chart-body"><canvas id="revenue-trend-chart"></canvas></div></div>
          <div class="card"><div class="card-header"><div class="card-title">Маржинальность, %</div><div class="card-subtle">Валовая · EBITDA · Чистая</div></div><div class="chart-body"><canvas id="margins-trend-chart"></canvas></div></div>
          <div class="card"><div class="card-header"><div class="card-title">Движение ДС (Waterfall), млн ₽</div><div class="card-subtle">Opening → OCF → ICF → FCF → Closing</div></div><div class="chart-body"><canvas id="cashflow-chart"></canvas></div></div>
          <div class="card"><div class="card-header"><div class="card-title">План vs Факт (Variance), млн ₽</div><div class="card-subtle">Revenue · COGS · Gross · OPEX · EBITDA</div></div><div class="chart-body"><canvas id="variance-chart"></canvas></div></div>
        </div>
      </section>
      <section id="page-sales" class="page-content">
        <div class="grid">
          <div class="card"><div class="card-header"><div class="card-title">Выручка по направлениям</div><div class="card-subtle">Абсолют / 100%</div></div><div class="chart-body"><canvas id="branches-sales-chart"></canvas></div></div>
          <div class="card"><div class="card-header"><div class="card-title">Средний чек (тренд)</div><div class="card-subtle">Sparkline</div></div><div class="chart-body"><canvas id="avg-check-chart"></canvas></div></div>
        </div>
      </section>
      <section id="page-profit" class="page-content">
        <div class="grid">
          <div class="card"><div class="card-header"><div class="card-title">EBITDA Bridge (Plan → Fact)</div><div class="card-subtle">Waterfall</div></div><div class="chart-body"><canvas id="ebitda-bridge-chart"></canvas></div></div>
          <div class="card"><div class="card-header"><div class="card-title">Маржа по филиалам</div><div class="card-subtle">Гориз. бары</div></div><div class="chart-body"><canvas id="margin-branches-chart"></canvas></div></div>
        </div>
      </section>
      <section id="page-cash" class="page-content">
        <div class="grid">
          <div class="card"><div class="card-header"><div class="card-title">Cash Flow Bridge</div><div class="card-subtle">OCF · ICF · FCF</div></div><div class="chart-body"><canvas id="cashflow-bridge-chart"></canvas></div></div>
          <div class="card"><div class="card-header"><div class="card-title">Прогноз ликвидности (недели)</div><div class="card-subtle">Линия</div></div><div class="chart-body"><canvas id="weekly-forecast-chart"></canvas></div></div>
        </div>
      </section>
      <section id="page-ar" class="page-content">
        <div class="grid">
          <div class="card"><div class="card-header"><div class="card-title">Aging (0-30 / 31-60 / 61-90 / 90+)</div><div class="card-subtle">Гориз. бары</div></div><div class="chart-body"><canvas id="aging-analysis-chart"></canvas></div></div>
          <div class="card"><div class="card-header"><div class="card-title">DSO (тренд)</div><div class="card-subtle">Линия</div></div><div class="chart-body"><canvas id="dso-trends-chart"></canvas></div></div>
        </div>
      </section>
    </main>
  </div>
  <script src="lib/Chart-2.9.4.min.js"></script>
  <script src="src/core/utils.js"></script>
  <script src="src/core/data.js"></script>
  <script src="src/core/state.js"></script>
  <script src="src/core/charts.js"></script>
  <script src="src/core/alerts.js"></script>
  <script src="src/core/renderers.js"></script>
  <script src="src/core/tabs.js"></script>
  <script src="src/core/ui-bindings.js"></script>
  <script src="src/index.js"></script>
</body>
</html>
