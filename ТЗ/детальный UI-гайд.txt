# Дизайн-токены (единые для всех экранов)

**Типографика**

* Базовый шрифт: системный стек (-apple-system, Segoe UI, Roboto, Arial).
* Размеры/вес: H1 20/600; H2 16/600; H3 14/600; Текст 14/400; Подпись 12/400.
* Числа: табличные (`tabular-nums`), межсимвольный 0, отсечки по сетке 4 px.
* Межстрочный: H1 28, H2 24, H3 20, Текст 20, Подпись 16.

**Цветовые роли (тёмная тема)**

* Фон экрана: #15181D. Поверхность (карточка): #1E2126. Поверхность-вторая: #242A31.
* Текст: основной #EAECEF; вторичный #A5AFBA; метки/ослабленный #7A8592.
* Контур/сетка: #2B3037; разделитель: #343A42.
* Акцент: #4DA3FF. Успех #16A34A; Ошибка #DC2626; Предупр. #F59E0B; Инфо #60A5FA.
* Положительные бары: успех; отрицательные — ошибка; итог/нейтраль — #9AA3AF.
* Наведение (hover bg): +6% к яркости поверхности.

**Размер/отступы**

* Сетка 8-px: 4 / 8 / 12 / 16 / 20 / 24 / 32 / 40.
* Радиусы: карточки 12; элементы управления 10; бейджи 8.
* Тени (одноуровневые, без blur-жести): `0 4 12 rgba(0,0,0,.28)`.

**Анимации**

* 120–150 мс, только opacity/transform. Без blur/backdrop-filter.

**Слои (z-index)**

* 10 Header; 20 Фильтры; 30 KPI-полоса; 40 Табы; 50 Виджеты; 100 Тосты/модалки.

# Каркас и сетка

* **Контейнер контента**: ширина 1320 px (min 1200, max 1440), центрирован, поля по бокам ≥ 16.
* **Сетка**: 12 колонок, gutter 16, row-gap 16/24.
* **Вертикальные sticky-зоны**:

  1. Header 56 px;
  2. Панель фильтров 68–72 px;
  3. KPI-полоса 88–96 px;
  4. Табы 44–48 px.
     Всё остальное — скролл содержимого одной колонкой (без горизонтального скролла).

# Панель фильтров (глобальные)

* Порядок: Период (Месяц/Квартал/Год + календарь) → Организации (multi, бейдж “+N”) → Сценарий (segmented: Факт / План / ПГ / Прогноз) → «Параметры» (меню: Валюта, Единицы: тыс/млн/млрд, НДС: с/без).
* Справа: **Применить** (primary), **Сброс** (ghost). Дебаунс 300–500 мс.
* Высота контролов: 36 px; зона клика ≥ 32×32.

# KPI-карточки (1 строка, 4–6 шт.)

* Внутри: Заголовок (H3) → Основное число (32–36 px, полужирный) → Дельта (иконка ↑/↓, % и знак) → подпись (например, «runway 4,2 мес»).
* Цвет дельты: успех/ошибка; числа — с единицами. Щелчок по карточке — переход на соответствующую вкладку.

# Вкладки разделов

* Один уровень: Обзор / Продажи / Прибыльность / ДДС и ликвидность / Дебиторка.
* Не смешивать с фильтрами. Активная вкладка — акцентная линия внизу.

# Сетка раздела «Обзор»

* Верх: **8 кол.** «Динамика выручки» \~310 px; **4 кол.** «Маржинальность, %» \~310 px.
* Низ: **8 кол.** «Движение ДС (Waterfall)» \~290 px; **4 кол.** «План vs Факт (Variance)» \~290 px.
* Все карточки выровнены по высоте; внутренние паддинги 16–20.

# Стандарт карточки-виджета

* **Шапка**: Заголовок (H2), подзаголовок-единицы (например, «млн ₽», «%»), справа иконки: «настройки» (локальные опции), «развернуть».
* **Тело**: график/контент, одинаковые отступы.
* **Футер** (опционально): легенда/примечания.
* Без локальных кнопок зума/масштабирования. Зум — через drag-to-zoom (если будет) + «Сброс» в тулбаре над графиком или в настройках.

# Правила графиков (единые)

* Толщина линий 2 px, маркеры 4–6; сетка тонкая (#2B3037).
* Легенда: сверху-слева, порядок серий = порядок в подписи.
* Серии/сценарии:

  * Факт — тёмно-синий; План — серый пунктир; Прогноз — синий пунктир; ПГ — светло-синий.
* Отрицательные значения (бары) — красные; нулевая линия — тонкая контрастная.
* Подписи осей: обязательны. X — месяцы формата `YYYY-MM` или «Янв 2024»; Y — единицы виджета.
* Tooltip (унифицирован): «Серия • Значение • ∆ к План/ПГ (если включено)».

**Специфика по виджетам**

* **Динамика выручки**: по умолчанию Факт+План. Прогноз и ПГ включаются из легенды (чекбоксы в легенде).
* **Маржинальность, %**: максимум 3 серии на экране (Валовая, EBITDA, Чистая). 4-ю и далее — через шестерёнку «показать все».
* **Waterfall ДС**: Притоки — зелёный, Оттоки — красный, Итог — серый; подписи значений — только в tooltip; итоговая колонка «Closing» обязательна.
* **План vs Факт (Variance)**: предпочтительно waterfall «Revenue→COGS→GP→OPEX→EBITDA»; альтернатива — дивергентные столбцы с нулём по центру.

# Тост-уведомления

* Правый верх; стек ≤3; ширина 320–380; авто-закрытие 6 с (high — 12 с).
* Состояния: info/warn/high/error; иконка + текст + ссылка «Подробнее». Без перекрытия контента слева.

# Состояния данных

* Loading — скелетоны полосами; Empty — нейтральная иконка + «Нет данных за выбранный период»; Error — компактный блок с текстом и кнопкой «Повторить».
* «Нет доступа» — отдельный шаблон с пояснением.

# Формат чисел и подписей

* Разделитель тысяч — узкий неразрывный пробел.
* Денежные:

  * < 1 млн: «xxx тыс ₽»; 1–999 млн: «x.y млн ₽»; ≥ 1000 млн: «x.y млрд ₽».
  * Знаков после запятой: 1 для млн/млрд; 0 для тысяч/шт.
* Проценты: обычно 1 знак, при |x|≥100 — 0.
* Знак ± обязателен для дельт.
* Даты на оси X — помесячно, шаг меток не реже 1/2 месяцев (читаемость).

# Ограничения производительности (v8webkit 8.3.27)

* Никакого **backdrop-filter/blur**, стековых теней и сложных фильтров.
* Одна таблица стилей ≤ 15 КБ; иконки — inline-SVG спрайт; без web-шрифтов.
* Минимум DOM-узлов в легендах и тулбарах; кликабельности ≥ 32×32.
* Анимации только opacity/transform, ≤150 мс.
* Layout — CSS Grid/Flex. Отказ от GridStack для базовой раскладки (drag\&drop не нужен на прод-экране CFO). Если требуется редактор компоновки — отдельный экран.

# Однофайловая сборка для 1С

* **Структура**:

  1. `<style>` — токены + базовые классы + компоненты (без импортов);
  2. `<svg>` спрайт иконок;
  3. `<div id="app">` каркас;
  4. `<script>` — инициализация, обработка фильтров, рендер графиков (библиотеки подключаются инлайном заранее).
* Плейсхолдеры для встраивания из 1С:

  * `%%INLINE_CSS%%`, `%%SVG_SPRITE%%`, `%%INLINE_LIBS_JS%%`, `%%APP_BOOTSTRAP%%`.
* Сжатие: минификация + удаление комментариев; цель — ≤ 250 КБ всего.

# Контрольный список миграции

1. Убрать локальные кнопки зума/дубликаты «Факт/План/ПГ/Прогноз» с карточек.
2. Внедрить sticky-зоны и новую сетку 12-col.
3. Нормализовать типографику и формат чисел (по токенам).
4. Перепаковать уведомления в toast-центр.
5. Прогнать состояния loading/empty/error на каждом виджете.
6. Проверить кликабельность (≥32×32) и контраст (AA).
7. Smoke-тест на 1280×800 и 1440×900 внутри 1С (тонкий/толстый клиент).