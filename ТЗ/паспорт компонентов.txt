# 1) Каркас (AppShell)

**Назначение:** общий шаблон экрана.

* Слои (sticky): Header 56 → FilterBar 72 → KPI 88–96 → Tabs 44–48 → Content.
* Контейнер: ширина 1320 (min 1200, max 1440), поля 16.
* Сетка контента: 12 колонок, gutter 16, row-gap 16/24.
* Z-index: Header 10, Filters 20, KPI 30, Tabs 40, Widgets 50, Toasts 100.

# 2) Header

**Состав:**
Лево — H1 «CFO Dashboard», подзаголовок (организация, период кратко).
Право — действия: «Экспорт», «Сохранить представление», «Сброс».
**Состояния:** норм / hover / disabled.
**Размеры:** высота 56, внутренние отступы 16/20.
**Клики:** минимум 32×32.
**Не делать:** вторых рядов, прокручиваемых элементов.

# 3) FilterBar (глобальные фильтры)

**Поля и порядок:**

1. Период: переключатель Месяц / Квартал / Год + выбор диапазона.
2. Организации: multiselect с бейджем «+N» и быстрым поиском.
3. Сценарий: segmented — Факт / План / ПГ / Прогноз (влияет на ВСЕ виджеты).
4. Параметры: выпадающее меню (Валюта ₽/др., Единицы тыс/млн/млрд, НДС с/без).
   Справа: **Применить** (primary) и **Сброс** (ghost).
   **Размеры:** высота контролов 36, вертикальный паддинг 12.
   **UX:** дебаунс 300–500 мс; «Применить» подсвечивается при отличии от сохранённого набора.
   **Ошибки:** под полем компактный текст (12 px), красная рамка.
   **Доступность:** Tab-цикл слева направо; Esc закрывает меню.

# 4) KPIList / KPICard

**Сетка:** 4–6 карточек в один ряд, одинаковая ширина.
**Внутри:** Заголовок (14/600) → Основное число (32–36/600, табличные цифры) → Дельта (иконка ↑/↓, % со знаком) → подпись («runway 4,2 мес»).
**Единицы:** всегда рядом с числом (например, «28,9 млн ₽»).
**Клик:** переход на профильную вкладку.
**Состояния:** normal / hover / pressed / disabled / loading (скелетон-полосы).
**Ограничения:** 1 строка — без скролла; лишние KPI в «Ещё…».

# 5) Tabs

**Назначение:** разделы данных.
**Список:** Обзор / Продажи / Прибыльность / ДДС и ликвидность / Дебиторка.
**Визуал:** текст 14/600, активная — акцентная линия снизу; не более 1 строки.
**Клавиатура:** ←/→ переключают вкладки.

# 6) WidgetCard (карточка виджета)

**Структура:**

* Header: Заголовок (16/600), подзаголовок-единицы («млн ₽», «%»). Справа: ⚙️ «Настройки» (локальные опции) и ⤢ «Развернуть».
* Body: график/контент с паддингом 16–20.
* Footer (опц.): примечания/легенда.
  **Состояния:** normal / hover / expanded (модалка/оверлей) / loading / empty / error.
  **Запрещено:** локальные кнопки зума/лупы и дубли фильтров сценариев.

# 7) Графические примитивы (единые правила)

**Оси/сетка:** сетка тонкая (#2B3037), подписи осей обязательны; X — помесячно («Янв 2024»), Y — единицы виджета.
**Линии:** 2 px, маркеры 4–6 px; анимации ≤150 мс, только opacity/transform.
**Цвета серий / сценариев:**

* Факт — тёмно-синий,
* План — серый пунктир,
* Прогноз — синий пунктир,
* ПГ — светло-синий.
  **Бары:** положительные — зелёные, отрицательные — красные, итог — нейтральный. Нулевая линия — контрастная.
  **Легенда:** сверху-слева, порядок соответствует данным; можно чекбоксами скрывать серии.
  **Tooltip (унифицирован):** заголовок точки (месяц) → список серий «Метка • Значение • ∆ к плану/ПГ (если активно)».
  **Кликабельность:** элементы управления ≥32×32.

## 7.1 Линейный график «Динамика выручки»

* По умолчанию: Факт + План; Прогноз/ПГ включаются из легенды.
* Подзаголовок: «млн ₽, помесячно».
* Ограничение серий одновременного показа: ≤3.

## 7.2 «Маржинальность, %»

* Макс. 3 метрики на экране (Валовая, EBITDA, Чистая).
* 4-ю и далее — через ⚙️ «Показать все».
* Ось Y: авто 0–60% (с безопасным запасом).

## 7.3 Waterfall «Движение ДС»

* Шаги: Opening → OCF → ICF → FCF → Closing (локализованные подписи).
* Притоки — зелёный; оттоки — красный; итог — серый.
* Подписи чисел — в tooltip; на колонках — только при hover.

## 7.4 «План vs Факт (Variance)»

* Предпочтительно waterfall по цепочке Revenue→COGS→GP→OPEX→EBITDA.
* Альтернатива: дивергентные бары с нулём по центру.

# 8) Toasts (уведомления)

**Место:** верх-право; стек до 3; ширина 320–380.
**Виды:** info / warn / high / error; иконка + заголовок + текст + «Подробнее».
**Жизнь:** 6 с (high — 12 с), по hover таймер стоп.
**Не перекрывать** контент слева/снизу.

# 9) Контролы (единые правила)

**Button:** primary / secondary / ghost / danger; высота 36; скругление 10; фокус-кольцо заметное.
**Segmented (сценарии):** 4 сегмента, один выбран; min-tap 40×36; не прокручивается.
**Select:** одно значение; **Multiselect:** чипы в строку, overflow превращается в бейдж «+N».
**DateRangePicker:** пресеты (М/Кв/Год), календарь диапазона; clear; валидация.
**Dropdown:** тень лёгкая, max-высота 320 с прокруткой.
**Badge:** компактный, 12 px текст.
**Toggle/Checkbox:** площадь клика ≥32; label справа.
**Поле ввода:** высота 36; плейсхолдер вторичный; ошибки красной рамкой и подписью (12 px).

# 10) Состояния данных

* **Loading:** скелетоны (полосы/блоки).
* **Empty:** иконка + «Нет данных за выбранный период».
* **Error:** краткий текст + «Повторить».
* **No access:** отдельный макет с пояснением.

# 11) Типографика и формат чисел

* Стек шрифтов: системный; `tabular-nums`.
* Базовый текст 14; H1 20/600; H2 16/600; H3 14/600; подписи 12.
* Денежные: неразрывный пробел между разрядами и единицами.

  * <1 млн: «xxx тыс ₽»; 1–999 млн: «x.y млн ₽»; ≥1000 млн: «x.y млрд ₽».
* Проценты: 1 знак после запятой (при |x|≥100 — 0).
* Даты X-оси: «Янв 2024», шаг меток ≥ каждый второй месяц.

# 12) Доступность / клавиатура

* Контраст текста и ключевых линий ≥ 4.5:1.
* Навигация Tab/Shift+Tab; Enter/Space активируют; Esc закрывает меню/модалки.
* Фокус-кольца видимы на всех интерактивах.
* Размер клика — не менее 32×32.

# 13) Производительность (v8webkit 8.3.27)

* Без `backdrop-filter`, blur, стековых теней.
* Одна таблица стилей ≤15 КБ; иконки — inline-SVG спрайт; без web-шрифтов.
* Минимум DOM в легендах/тулбарах.
* Анимации только opacity/transform ≤150 мс.
* Layout — CSS Grid/Flex (без GridStack на прод-экране).

# 14) Размещение раздела «Обзор» (референс)

* Верхний ряд:

  * 8 колонок — «Динамика выручки», высота \~310;
  * 4 колонки — «Маржинальность, %», высота \~310.
* Нижний ряд:

  * 8 колонок — «Движение ДС (Waterfall)», \~290;
  * 4 колонки — «План vs Факт (Variance)», \~290.
* Все карточки выровнены по сетке, одинаковые паддинги.

# 15) Однофайловая сборка (интеграция в 1С)

**Секции файла:**

1. Токены/базовые стили (≤15 КБ).
2. SVG-спрайт иконок.
3. Каркас DOM (AppShell слоты).
4. Скрипт инициализации (подключение графической библиотеки + привязка фильтров).
   **Плейсхолдеры встраивания:** `%%INLINE_CSS%%`, `%%SVG_SPRITE%%`, `%%INLINE_LIBS_JS%%`, `%%APP_BOOTSTRAP%%`.
   **Глобальный API для 1С (минимум):**

* `setFilters(state)` — применить набор фильтров к UI (без запроса к данным).
* `applyFilters(state)` — подтвердить и запросить данные.
* `updateData(payload)` — отрисовать полученные наборы (продажи/маржа/ДС/вариансы).
* `showToast(level, title, text)` — уведомления.

# 16) Чек-лист внедрения (миграция)

1. Разнести шапку/фильтры/KPI/табы по sticky-зонам.
2. Переложить сетку «Обзор» на 12-колоночную, выровнять высоты.
3. Убрать локальные зумы/дубли сценариев; оставить ⚙️ и ⤢.
4. Привести числа/единицы к правилам (тыс/млн/млрд, %, знаки).
5. Перенести уведомления в toast-центр.
6. Ввести состояния loading/empty/error на каждом виджете.
7. Проверить доступность и кликабельность.
8. Собрать однофайлово (inline CSS/SVG/JS), протестировать в тонком/толстом клиенте.

# 17) Sprint 2 (реализация верстки)

* Компоненты: AppShell, Header, FilterBar, KPICard, Tabs, WidgetCard, Toasts, Segmented, Select/Multiselect, DateRangePicker, Dropdown, Badge, Buttons, Empty/Skeleton/Error.
* Паттерны графиков: Line, Waterfall, Divergent Bars; единые легенда/tooltip/цвета.
* Демостраница с мок-данными и четырьмя разрешениями: 1200×800, 1366×768, 1440×900, 1920×1080.