# Что тревожит в текущем экране

1. **Перегруженная «шапка»**: KPI-карточки + фильтры + иконки смешаны. Селекты налезают на виджеты, уведомление частично перекрыто.
2. **Непоследовательная типографика и числа**: разные размеры, длинные подписи единиц, местами нет единообразия «млн ₽ / %».
3. **Дубли элементов управления на виджетах**: «Факт / vs ПГ / vs План / Прогноз» продублировано в нескольких карточках и выглядит как фильтры, хотя это переключатели серий.
4. **Избыточные иконки масштабирования (Q+, Q-, ↺)** на каждом графике — визуальный шум и потенциальные лаги.
5. **Уведомления** внизу слева, с маленьким кликабельным крестом — UX слабый, перекрытия по z-index.
6. **Легенды и подписи**: местами несоответствие порядку серий и/или слабая читаемость «валовая/EBITDA/чистая маржа».
7. **Единицы измерения в заголовках** не последовательны («млн ₽», «%», «Variance, млн ₽») и частично на английском.
8. **Плотность сетки**: карточки немного «плавают», нет ритма по вертикали, высоты виджетов отличаются без причины.
9. **Микро-контролы** (лупы/плюсы/минусы) — кликабельные зоны меньше 32×32 px (Fitts’ Law), мимо кликов будет много.
10. **Цвета**: активные/неактивные серии и состояния фильтров недостаточно контрастны. Для тёмной темы это критично.

# Что оставить из логики графиков

* **Динамика выручки, млн ₽** — ок (линия по месяцам), но: единицы в подписи, единый «сценарий» (Факт/План/Прогноз/ПГ) как переключатель серии, а не отдельные кнопки в каждом виджете.
* **Маржинальность, %** — ок, но ограничить до 3 метрик максимум (например, Валовая, EBITDA, Чистая). Если 4+, сделать переключатель «показать 3 ключевых / все».
* **Движение ДС (waterfall)** — ок, обязательно красить отрицательные в «минус», показывать итог «Closing» как финальную колонку.
* **План vs Факт (Variance)** — допустимо, но эффективнее **waterfall-разложение отклонения** (Revenue → COGS → GP → OPEX → EBITDA), либо «дивергентные бары» с нулём посередине.

Лишнее/на пересмотр:

* Иконки масштабирования и «локальные» кнопки зума на каждом графике — убрать. Зум/панорамирование либо глобально, либо через drag-to-zoom с кнопкой «Сброс».
* Дубли «Факт / vs ПГ / vs План / Прогноз» на нескольких карточках — централизовать.

# Новый каркас (UX-раскадровка)

**12-колоночная сетка, фиксированная ширина контента 1280–1440 px, gutter 16 px.**

1. **Верхняя полоса (sticky, высота \~56 px)**

   * Слева: заголовок «CFO Dashboard», подзаголовок: организация, период.
   * Справа: иконки «Экспорт», «Сохранить представление», «Сброс».

2. **Панель фильтров (sticky, высота \~64–72 px)**

   * Порядок:

     * Период (кнопки: Месяц/Квартал/Год + календарь)
     * Организация (multiselect, с бейджем «+N»)
     * Сценарий (segmented: Факт / План / ПГ / Прогноз — влияет на все виджеты)
     * Валюта (₽ / валюта отчёта), Единицы (тыс/млн), НДС (с/без) — **компактное раскрывающееся меню «Параметры»**.
   * Кнопка «Применить» и «Сброс» справа. Дебаунс 300–500 мс.

3. **KPI-полоса (одна строка, 4–6 карточек, высота \~80–96 px)**

   * Единый стиль: Заголовок, Основное число, Дельта (↑/↓, % и знак), вторичный текст (напр. «runway: 4.2 мес»).
   * Без скролла; если метрик больше — карусель/переключатель.

4. **Табы разделов (Обзор / Продажи / Прибыльность / ДДС / Ликвидность / Дебиторка)**

   * Один уровень, **без второй полосы селектов**. Каждый раздел — набор виджетов своей сетки.

5. **Сетка виджетов раздела «Обзор»**

   * Левый 8 колонок: «Динамика выручки» (линия); под ним — «Движение ДС (Waterfall)».
   * Правый 4 колонки: «Маржинальность, %» (точки/линии с одной шкалой), ниже — «План vs Факт (Variance)».
   * Высоты унифицировать (верхние виджеты \~300–320 px, нижние \~280–300 px) для ровного ритма.

6. **Уведомления**

   * В правом верхнем углу как **toast-центр** (stack, auto-dismiss, уровни: info/warn/high). Никаких панелей, перекрытий слева.

# Стандарты стилей (для v8webkit 8.3.27)

* **Шрифты**: системный стек (-apple-system, Segoe UI, Roboto, Arial). **font-variant-numeric: tabular-nums** для чисел. Базовый размер 14 px; заголовки: 20/16/14.
* **Цвета**: нейтральная палитра + один акцент. Контраст AA.

  * Текст: #EDEFF2 / #9AA3AF / #6B7280
  * Контуры/сетки: #2A2E34 (тёмная тема)
  * Акцент: #4DA3FF (синий) или твой брендовый
  * Положит.: #16A34A, Отрицат.: #DC2626, Предупр.: #F59E0B
* **Фон**: одна подложка (без «liquid glass» и backdrop-filter — тяжёлые для webkit в 1С). Карточки: #1E2126, тень лёгкая (0 4 12 rgba(0,0,0,.3)).
* **Радиусы**: 12–16 px для карточек, 10 px для чипов.
* **Ритм**: шаг 8 px (8/16/24/32). Внутренние отступы карточек: 16–20 px.
* **Кликабельность**: минимум 32×32 px. Hover/focus-состояния обязательны.
* **Анимации**: ≤150 мс, только opacity/transform, не blur, не backdrop.
* **Локализация чисел**: RU-locale, тонкая неразрывная пробельная между разрядами и единицами: `125,6 млн ₽`, проценты с одним знаком после запятой при |значении|<100; иначе без дробной части.

  * Формат:

    * < 1 млн — «xxx тыс ₽»
    * 1–999 млн — «x.y млн ₽»
    * ≥ 1000 млн — «x.y млрд ₽»
* **Элементы графиков** (единые правила):

  * Толщина линий 2 px, маркеры 4–6 px, сетка тонкая; легенда сверху-слева; единицы в подзаголовке виджета: «млн ₽», «%».
  * Цвета серий: Факт — тёмно-синий, План — серый пунктир, Прогноз — синий пунктир, ПГ — светло-синий.
  * Отрицательные столбцы — красные; ноль выделен тонкой линией.
  * Tooltip унифицирован: Название серии, значение, ∆ vs ПГ/План (если включено).

# Размещение фильтров и вкладок (UX)

* **Глобальные фильтры**: Период, Организация, Сценарий, Валюта/Единицы/НДС — единая панель над табами. Они **влияют на все** виджеты, точка.
* **Локальные фильтры виджета** (редко): иконка ⚙️ в правом верхнем углу карточки → выпадающее меню (пример: «Показывать EBITDA/Чистую»).
* **Вкладки**: только разделы данных. Не смешивать с фильтрами.
* **Сохранённые представления**: «Сохранить» (запоминаем набор фильтров) и быстрый переключатель.

# Перепаковка виджетов (по одному)

1. **Динамика выручки**

   * Линия(и) по месяцам: Факт, План, Прогноз, ПГ. По умолчанию — Факт+План.
   * Декларативный «Сценарий» приходит сверху (панель фильтров), внутри виджета только легенда.
   * Заголовок: «Динамика выручки», подзаголовок: «млн ₽, помесячно».

2. **Маржинальность, %**

   * Три серии max (Валовая, EBITDA, Чистая). Четвёртую увести в настройку виджета.
   * Ось Y: 0–50/60% автоподбор. Точки с линиями, без заливки.

3. **Движение ДС (Waterfall)**

   * Цветовая кодировка: притоки — зелёный, оттоки — красный, итог — серый.
   * Подписи под колонками краткие: Opening / OCF / ICF / FCF / Closing (локализовать на RU).
   * Показать «подписи на колонках» только при hover — экономит визуальный шум.

4. **План vs Факт (Variance)**

   * Вариант 1 (предпочтительно): waterfall от выручки к EBITDA с позитив/негатив шагами.
   * Вариант 2: дивергентные бары по статьям (центр — 0, вправо — перевыполнение, влево — недовыполнение).

# Технические ограничения 8.3.27 v8webkit — учитывать

* Без `backdrop-filter`, **без** сложных blur/теней — заметные лаги.
* CSS-переменные использовать умеренно — поддерживаются, но не устраивать «темизацию на лету».
* `position: sticky` работает, но тестировать; fallback — фиксированная шапка.
* **Без тяжёлых библиотек для layout**: отказаться от GridStack для базовой раскладки; обычный CSS Grid/Flex хватит.
* SVG-иконки инлайн (спрайт), без внешних шрифтов-иконок.
* Одна таблица стилей ≤12–15 КБ, JS для layout ≤5 КБ. Без сторонних шрифтов — только системный стек.

# Нормы доступности/качества

* Контраст текста и ключевых линий ≥ 4.5:1.
* Фокус-кольца для клавиатуры на всех интерактивах.
* Все KPI с единицами, подпись осей у графиков обязательна.
* Отсутствующие данные — «—» и серый плейсхолдер.

# Приоритезированная доработка (Sprint 1)

1. Разнести **шапку/фильтры/KPI** по трем слоям (sticky) с фиксированными высотами.
2. Ввести **глобальные фильтры** и убрать локальные дубли на виджетах.
3. Перестроить сетку «Обзор» (8+4 колонки; ровные высоты).
4. Привести **типографику и формат чисел** к единому стандарту.
5. Перепаковать **уведомления** в правый верхний toast-центр.
6. Удалить иконки зума на виджетах, оставить «развернуть» и «настройки».
7. Единая легенда/цвета серий; ограничить количество одновременных серий.
8. Прогнать по чек-листу доступности и кликабельности.

# Результат

* Экран станет чище: 1 панель фильтров, ровная сетка, понятные KPI.
* Производительность в v8webkit вырастет за счёт упрощения стилей и избавления от тяжёлых эффектов/контролов.
* Дальше можно собрать всё в один файл (inline CSS + SVG-иконки + минимальный JS) без зависимости от внешних CDN.